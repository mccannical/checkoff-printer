services:
  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    restart: unless-stopped

  backend:
    build: ./backend
    expose:
      - "8080"
    environment:
      - PRINTER_MODE=${PRINTER_MODE:-mqtt}
      - MQTT_BROKER_HOST=${MQTT_BROKER_HOST:-mosquitto}
      - MQTT_BROKER_PORT=${MQTT_BROKER_PORT:-1883}
      - MQTT_BROKER_USER=${MQTT_BROKER_USER:-printer}
      - MQTT_BROKER_PASS=${MQTT_BROKER_PASS:-printer}
      - MQTT_PRINTERS=${MQTT_PRINTERS:-jesse-printer:Jesse,kitchen-huxley:Kitchen}
    volumes:
      - logs:/app/logs
    depends_on:
      - mosquitto
    restart: unless-stopped

  mosquitto:
    image: eclipse-mosquitto:2
    expose:
      - "1883"
    ports:
      - "1883:1883"
      - "9883:9883"
    volumes:
      - mosquitto-data:/mosquitto/data
      - mosquitto-log:/mosquitto/log
    restart: unless-stopped

volumes:
  logs:
  mosquitto-data:
  mosquitto-log:
